<!DOCTYPE html>
<html>

<body>


  <style>
    #menu ul {
      padding:0px;
      margin:0px;
      background-color:#EDEDED;
      list-style:none;
    }
    #menu ul li { display: inline; }
    
    #menu ul li a {
      padding: 2px 10px;
      display: inline-block;
    
      /* visual do link */
      background-color:#EDEDED;
      color: #333;
      text-decoration: none;
      border-bottom:3px solid #EDEDED;
    }
    
    #menu ul li a:hover {
      background-color:#D6D6D6;
      color: #6D6D6D;
      border-bottom:3px solid #EA0000;
    }
    
    </style>    
    
    <nav id="menu">
      <ul>
        <li><a href="./MarcarConsulta.html">Marcar consulta</a></li>
        <li><a href="./FincanceiroMedico.html">Folha de pagamento</a></li>
        <li><a href="./cadastrarPaciente.html">Cadastrar paciente </a></li>
        <li><a href="./CadastarMedico.html">Cadastrar medico</a></li>
        <li><a href="./VerConsultasPaciente.html">Historico do paciente</a></li>
      </ul>
    </nav>


  <h2> MARCAR CONSULTA </h2>





  <form action="">

    <label for="fname"> NUMERO DE DOCUMENTO PACIENTE:</label><br>
    <input type="text" id="PACIENTE" name="fname"></br>
    </br> 
    <div id = "listagem"> 
      loading...
       </div>
    </br>

    </br>
    <label for="lname">HORARIO INICIO </label>:</label><br>
    <input type="datetime-local" id="HORARIO_INICIO" name="meeting-time" value="2018-06-12T19:30" min="2018-06-07T00:00"
      max="2018-06-14T00:00"><br><br>

    <label for="lname">HORARIO FIM </label>:</label><br>
    <input type="datetime-local" id="HORARIO_FIM" name="meeting-time" value="2018-06-12T19:30" min="2018-06-07T00:00"
      max="2018-06-14T00:00"><br><br>


    <label for="lname">SITUACAO ATUAL DO PACIENTE  </label>:</label><br>
    <textarea id="RELATORIO" name="story"
    rows="5" cols="33" placeholder = "Descreva como o paciente esta de saude ">

</textarea><br><br>


    <label for="lname">VALOR ATUAL DA CONSULTA </label>:</label><br>
    <input type="text" id="VALOR" name="fname"></br>

</textarea>
<br><br>

    <input type="submit" value="Submit" onClick="event.preventDefault(); requestForm();">
  </form>



  <script>

    //PEGANDO TODOS OS DADOS DE OUTRAS TABELAS

    let OurDataList = null;



    fetch('http://127.0.0.1:4000/medico/all', { method: 'GET' })
      .then(response => response.text())
      .then(texto => {

        listData = JSON.parse(texto);
        console.log(listData);
        let OurHtmlData = `<label for="lname"> PREFERENCIA MEDICO </label>:</label><br>
    <input list="browsers" name="browser" id = "PREFERENCIA_MEDICO"> <datalist id="browsers">`;
        for (let i = 0; i < listData.length; i++) {
          OurHtmlData += `<option value="${listData[i].REGISTRO_CLINICA}" label =${listData[i].NOME} /> `;
        }

        OurHtmlData += "</datalist>";


        document.getElementById("listagem").innerHTML = OurHtmlData;


        JSON.parse(texto)
        console.log(JSON.parse(texto))
      })
      .catch(err => console.log(err.message))






    const requestForm = () => {


/* 
      console.log(`DEU TUDO CERTO \n  ${document.getElementById("nome").value} 
      \n  ${document.getElementById("porcentagem").value}
      ${document.getElementById("especialidade").value}

      `);
 */




      (async () => {

        const rawResponse = await fetch('http://127.0.0.1:4000/consulta/add', {
          method: 'POST',
          headers: {
            'Accept': 'application/json',
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({

            PACIENTE: document.getElementById("PACIENTE").value,
            PREFERENCIA_MEDICO_PACIENTE: document.getElementById("PREFERENCIA_MEDICO").value,
            MOMENTO_INICIO: document.getElementById("HORARIO_INICIO").value,
            MOMENTO_FIM: document.getElementById("HORARIO_FIM").value,
            RELATORIO_CONSULTA : document.getElementById("RELATORIO").value,
            VALOR : document.getElementById("VALOR").value,

          })
        });
        const content = await rawResponse.json();

        console.log(content);
      })();

    } 
  </script>



</body>



</html>